# @configure_input@

# Package-related substitution variables
package        = @PACKAGE_NAME@
version        = @PACKAGE_VERSION@
tarname        = @PACKAGE_TARNAME@
distdir        = $(tarname)-$(version)

# Prefix-related substitution variables
prefix         = @prefix@
exec_prefix    = @exec_prefix@
bindir         = @bindir@
libdir         = @libdir@
includedir     = @includedir@

# VPATH-specific substitution variables
srcdir         = @srcdir@
VPATH          = @srcdir@

# Tool-specific substitution variables
CC             = @CC@
DEFS           = @DEFS@
LIBS           = libmodres.a @LIBS@
CFLAGS         = @CFLAGS@
CPPFLAGS       = @CPPFLAGS@
INSTALL        = @INSTALL@
INSTALL_DATA   = @INSTALL_DATA@
INSTALL_PROGRAM= @INSTALL_PROGRAM@
INSTALL_SCRIPT = @INSTALL_SCRIPT@

# Stuff to be built / distributed
executables=makeActionMatrices makeNontips groupInfo perm2Gap makeInclusionMatrix
objects=pincl pgroup aufloesung
c_sources=$(objects) mam mnt gi perm2Gap mim pmatrix urbild aufnahme slice nBuchberger
headers=aufloesung_decls aufnahme_decls modular_resolution nBuchberger_decls nDiag pcommon pgroup_decls pgroup pincl_decls pincl pmatrix_decls slice_decls urbild_decls



Makefile: Makefile.in config.status
		./config.status $@

config.status: configure
		./config.status --recheck

dist: $(distdir).tar.gz

$(distdir).tar.gz: FORCE $(distdir)
	tar chof - $(distdir) | gzip -9 -c >$(distdir).tar.gz
	rm -rf $(distdir)

$(distdir):
	mkdir -p $(distdir)/src
	cp $(srcdir)/configure.ac $(distdir)
	cp $(srcdir)/configure $(distdir)
	cp $(srcdir)/config.h.in $(distdir)
	cp $(srcdir)/install-sh $(distdir)
	cp $(srcdir)/Makefile.in $(distdir)
	cp $(headers:%=$(srcdir)/src/%.h) $(c_sources:%=$(srcdir)/src/%.c) $(distdir)/src
	cp $(srcdir)/src/test.reg $(distdir)/src

distcheck: $(distdir).tar.gz
	gzip -cd $(distdir).tar.gz | tar xvf -
	cd $(distdir) && $(MAKE) all
	cd $(distdir) && $(MAKE) clean
	$(RM) -rf $(distdir)

install:
	$(INSTALL) -d $(bindir)
	$(INSTALL_PROGRAM) -m 0755 $(executables) $(bindir)
	$(INSTALL) -d $(libdir)
	$(INSTALL) libmodres.a $(libdir)
	$(INSTALL) -d $(includedir)
	$(INSTALL) $(srcdir)/src/modular_resolution.h $(includedir)

uninstall:
	-$(RM) $(executables:%=$(bindir)/%)
	-$(RM) $(libdir)/libmodres.a
	-$(RM) $(includedir)/modular_resolution.h

delete:
	-$(RM) $(objects:%=%.o) $(c_sources:%=%.o) $(executables) libmodres.a

clean:
	-$(RM) $(objects:%=%.o) $(c_sources:%=%.o) libmodres.a

FORCE:
	-$(RM) $(distdir).tar.gz &> /dev/null
	-$(RM) -rf $(distdir) &> /dev/null

## Building the executables

makeActionMatrices: libmodres.a mam.o
	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ mam.o $(LIBS)

makeNontips: libmodres.a mnt.o
	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ mnt.o $(LIBS)
	echo "Testing makeNontips"
	./makeNontips -O RLL 2 $(srcdir)/src/test

groupInfo: libmodres.a gi.o
	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ gi.o $(LIBS)

perm2Gap: libmodres.a perm2Gap.o
	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $@.o $(LIBS)

matmag: libmodres.a matmag.o
	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $@.o $(LIBS)

makeInclusionMatrix: libmodres.a mim.o
	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ mim.o $(LIBS)

## Building the library

%.o: src/%.c
	$(CC) -I. -I$(srcdir) -I.. -c $(CFLAGS) $(DEFS) $(CPPFLAGS) -o $@ $<

libmodres.a: $(objects:%=%.o)
	@echo $(LIBS)
	@echo "Creating $@"
	@$(RM) -f $@
	$(AR) r $@ $(objects:%=%.o)

.PHONY: FORCE all clean dist distcheck install uninstall build
